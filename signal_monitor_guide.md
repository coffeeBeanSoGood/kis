# 📊 매매 신호 모니터링 시스템 완벽 가이드 v1.2

**SignalMonitor_KR.py - 초보자를 위한 상세 설명서 (신호 점수 정규화 시스템)**

---

## 📑 목차

1. [시스템 개요](#1-시스템-개요)
2. [주요 기능](#2-주요-기능)
3. [동작 원리](#3-동작-원리)
4. [신호 분석 로직](#4-신호-분석-로직)
5. [점수 계산 방식](#5-점수-계산-방식)
6. [신호 등급 체계](#6-신호-등급-체계)
7. [알림 시스템](#7-알림-시스템)
8. [중복 방지 로직](#8-중복-방지-로직)
9. [설정 가이드](#9-설정-가이드)
10. [실행 방법](#10-실행-방법)
11. [로그 및 히스토리](#11-로그-및-히스토리)
12. [웹 대시보드](#12-웹-대시보드) ⭐ NEW!
13. [FAQ](#13-faq)

---

## 1. 시스템 개요

### 🎯 목적
실제 자동매매를 시작하기 전에 **매매 신호의 정확도를 검증**하는 시스템입니다.

### 📌 핵심 컨셉
```
실시간 모니터링 → 5가지 지표 분석 → 점수화 → 신호 생성 → 알림 발송 → 히스토리 저장
```

### ✨ 주요 특징
- ✅ **20개 종목** 동시 모니터링 (5개 섹터)
- ✅ **5가지 지표** 종합 분석 (가중치 시스템)
- ✅ **0-100점** 점수화 시스템 (정규화 알고리즘)
- ✅ **신뢰도 평가** 시스템 (40% 미만 자동 제외)
- ✅ **중복 알림 방지** (조용한 모드)
- ✅ **콘솔 + 디스코드** 이중 알림
- ✅ **JSON 히스토리** 자동 저장 (7일 관리)
- ✅ **장중 시간 자동 체크**
- ✅ **API 스로틀링** (안정성 99%)
- ✅ **외국인/기관 캐싱** (속도 3배)
- ✅ **웹 대시보드** 실시간 모니터링 ⭐ NEW!

---

## 2. 주요 기능

### 📊 모니터링 대상 종목 (20개)

#### 🤖 로봇 섹터 (4개)
| 종목명 | 코드 | 특징 |
|--------|------|------|
| 유진로봇 | 056080 | 협동로봇 선두 |
| 에스에프에이 | 056190 | 반도체 자동화 |
| 로보티즈 | 108490 | 교육/서비스 로봇 |
| 티로보틱스 | 117730 | 의료용 로봇 |

#### ⚡ 원전 섹터 (4개)
| 종목명 | 코드 | 특징 |
|--------|------|------|
| 두산에너빌리티 | 034020 | 원전 핵심 업체 |
| 삼성중공업 | 010140 | 원전 건설 |
| HD현대 | 267250 | 원전 기자재 |
| SJM홀딩스 | 123700 | 원전 부품 |

#### 🚀 방산 섹터 (4개)
| 종목명 | 코드 | 특징 |
|--------|------|------|
| 한화오션 | 042660 | 함정/잠수함 |
| 한화에어로스페이스 | 012450 | 항공우주 |
| 한화시스템 | 272210 | 방산 전자 |
| SNT모티브 | 064960 | 방산 부품 |

#### 🔋 2차전지 섹터 (4개)
| 종목명 | 코드 | 특징 |
|--------|------|------|
| LG에너지솔루션 | 373220 | 배터리 1위 |
| 삼성SDI | 006400 | 배터리 2위 |
| LG화학 | 051910 | 배터리 소재 |
| SK이노베이션 | 096770 | 배터리 분리막 |

#### 💾 반도체 섹터 (4개)
| 종목명 | 코드 | 특징 |
|-----------|-----------|-----------|
| 삼성전자 | 005930 | 메모리 반도체 |
| SK하이닉스 | 000660 | D램/낸드 |
| DB하이텍 | 000990 | 파운드리 |
| 유진테크 | 084370 | 반도체 장비 |

---

## 3. 동작 원리

### 🔄 전체 프로세스

```
시작
 ↓
[1] API 초기화 (키움증권 연결)
 ↓
[2] 장중 시간 체크 (09:00-15:30)
 ↓
[3] 20개 종목 순차 분석 (5분마다)
 ↓
[4] 각 종목별 5가지 지표 수집
 ↓
[5] 점수 계산 (0-100점)
 ↓
[6] 신호 등급 결정 (STRONG_BUY ~ STRONG_SELL)
 ↓
[7] 중복 체크 (이전 신호와 비교)
 ↓
[8] 알림 발송 (콘솔 + 디스코드)
 ↓
[9] 히스토리 저장 (JSON)
 ↓
대기 (5분) → [2]로 반복
```

### ⏰ 실행 주기

- **체크 간격**: 5분마다 자동 실행
- **장중 시간**: 평일 09:00 ~ 15:30만 동작
- **장외 시간**: 대기 상태 (리소스 절약)

---

## 4. 신호 분석 로직

### 📈 5가지 분석 지표 (가중치 시스템)

시스템은 각 종목을 **5가지 지표**로 분석하여 점수를 매기고, **가중치를 적용**하여 최종 점수를 계산합니다.

#### 📊 지표별 가중치 (INDICATOR_WEIGHTS)

| 지표 | 가중치 | 중요도 |
|------|--------|--------|
| 호가 분석 | 20% | 매수/매도 세력 균형 |
| 체결강도 | 20% | 실시간 거래 강도 |
| 외국인/기관 | 25% | **최고 중요도** (세력 동향) |
| 현재가/거래량 | 20% | 가격 추세 |
| 고급 추세 | 15% | 기술적 위치 |

#### 1️⃣ 호가 분석 (가중치 20%)

**분석 대상**: 매수호가 vs 매도호가 잔량 비율

| 매수 비율 | 점수 | 신호 의미 |
|-----------|------|-----------|
| 70% 이상 | 100점 | ✅ 매수세 매우 강함 |
| 60-70% | 75점 | ✓ 매수세 우세 |
| 40-60% | 50점 | ➖ 균형 |
| 30-40% | 25점 | ⚠ 매도세 우세 |
| 30% 미만 | 0점 | ❌ 매도세 매우 강함 |

**예시**:
```
매수잔량: 100,000주
매도잔량: 50,000주
→ 매수비율: 66.7% → 75점
→ 가중치 적용: 75 × 0.20 = 15점 기여
```

#### 2️⃣ 체결강도 분석 (가중치 20%)

**분석 대상**: 실시간 체결강도 (매수/매도 체결량 비율)

| 체결강도 | 점수 | 신호 의미 |
|----------|------|-----------|
| 150% 이상 | 100점 | ✅ 매우 강한 매수 체결 |
| 120-150% | 75점 | ✓ 강한 매수 체결 |
| 90-120% | 50점 | ➖ 보통 |
| 80-90% | 25점 | ⚠ 약한 매수 체결 |
| 80% 미만 | 0점 | ❌ 매우 약한 매수 체결 |

**예시**:
```
체결강도: 156%
→ 매수 체결이 매도보다 56% 많음 → 100점
→ 가중치 적용: 100 × 0.20 = 20점 기여
```

#### 3️⃣ 외국인/기관 매매 동향 (가중치 25% - 최고 중요도)

**분석 대상**: 외국인 + 기관 순매수/순매도 수량

| 상황 | 점수 | 신호 의미 |
|------|------|-----------|
| 외국인+기관 모두 순매수 | 100점 | ✅ 세력 동반 매수 |
| 외국인 또는 기관 순매수 | 75점 | ✓ 세력 매수 |
| 중립 | 50점 | ➖ 세력 관망 |
| 외국인 또는 기관 순매도 | 25점 | ⚠ 세력 매도 |
| 외국인+기관 모두 순매도 | 0점 | ❌ 세력 동반 매도 |

**예시**:
```
외국인: +12,345주 (순매수)
기관: +5,678주 (순매수)
→ 동반 순매수 → 100점
→ 가중치 적용: 100 × 0.25 = 25점 기여 (최고 기여도)
```

#### 4️⃣ 현재가/거래량 분석 (가중치 20%)

**분석 대상**: 당일 등락률 + 거래량 보너스

| 등락률 | 점수 | 신호 의미 |
|--------|------|-----------|
| +3% 이상 | 100점 | ✅ 강한 상승세 |
| +1% ~ +3% | 75점 | ✓ 상승세 |
| -1% ~ +1% | 50점 | ➖ 보합 |
| -1% ~ -3% | 25점 | ⚠ 하락세 |
| -3% 이하 | 0점 | ❌ 강한 하락세 |

**거래량 보너스**:
- 거래량 100만주 이상: +10점 추가 (최대 100점)

**예시**:
```
등락률: +3.85%
거래량: 1,234,567주
→ 100점 (상승세) + 10점 (거래량) = 100점 (상한)
→ 가중치 적용: 100 × 0.20 = 20점 기여
```

#### 5️⃣ 고급 추세 분석 (가중치 15%)

**분석 대상**: 고가/저가 위치, 모멘텀, 상한가/하한가 근접도

**3가지 분석 요소** (최대 ±37점 범위):

##### A. 고가/저가 대비 현재가 위치 (±15점 또는 ±8점)
```
고가 근접 (상위 80% 이상): +15점 → 85점
상단 위치 (상위 60-80%): +8점 → 58점
중립 (40-60%): 0점 → 50점
하단 위치 (하위 40-60%): -8점 → 42점
저가 근접 (하위 80% 이상): -15점 → 35점
```

##### B. 시가 대비 모멘텀 (±10점 또는 ±5점)
```
강한 상승 (+3% 이상): +10점 → 60점
상승 (+1~3%): +5점 → 55점
보합 (-1~+1%): 0점 → 50점
하락 (-3~-1%): -5점 → 45점
강한 하락 (-3% 이하): -10점 → 40점
```

##### C. 상한가/하한가 근접도 (±12점)
```
상한가 근접 (거리 5% 이내): +12점 → 62점
하한가 근접 (거리 5% 이내): -12점 → 38점
```

**예시**:
```
[한화오션 분석]
현재가: 46,000원
시가: 45,000원 (모멘텀: +2.22%)
고가: 47,000원
저가: 44,000원
상한가: 58,000원

1. 고가/저가 위치
   범위: 3,000원 (47,000 - 44,000)
   위치: 2,000원 (46,000 - 44,000)
   위치율: 66.7% (상위 60-80%)
   → +8점 → 58점

2. 시가 대비 모멘텀
   변동: +2.22% (+1~3% 구간)
   → +5점 → 63점

3. 상한가 근접도
   거리: 26.1% (상한가까지 멀음)
   → 0점 → 63점

최종 추세 점수: 63점
→ 가중치 적용: 63 × 0.15 = 9.45점 기여
```

---

## 5. 점수 계산 방식 (가중치 정규화 시스템)

### 🧮 정규화 점수 계산 공식

```
1단계: 각 지표별 점수 계산 (0-100점)
2단계: 가중치 적용
3단계: 정규화된 최종 점수 산출

최종 점수 = Σ(지표점수 × 가중치) / Σ(사용된 지표의 가중치)

최소점수: 0점
최대점수: 100점
기본점수: 50점 (중립)
```

### 📊 신뢰도(Confidence) 계산

```
신뢰도 = (사용된 지표의 가중치 합) / (전체 지표 가중치 합)

예시:
- 5개 지표 모두 사용: 1.00 / 1.00 = 100%
- 4개 지표 사용 (trend 제외): 0.85 / 1.00 = 85%
- 3개 지표 사용: 0.65 / 1.00 = 65%
- 2개 지표 사용: 0.45 / 1.00 = 45%

⚠️ 신뢰도 40% 미만인 신호는 자동 제외됨
⚠️ 최소 2개 지표 필요 (min_required_indicators)
```

### 📊 점수 계산 예시

#### 예시 1: 강한 매수 신호 (5개 지표 모두 사용)

```
종목: 한화오션

[1] 호가 분석 (가중치 20%)
    매수비율: 72.3%
    → 지표점수: 100점
    → 기여도: 100 × 0.20 = 20.0점

[2] 체결강도 (가중치 20%)
    체결강도: 156.2%
    → 지표점수: 100점
    → 기여도: 100 × 0.20 = 20.0점

[3] 외국인/기관 (가중치 25%) ⭐ 최고 비중
    외국인: +12,345주
    기관: +5,678주
    → 지표점수: 100점 (동반 순매수)
    → 기여도: 100 × 0.25 = 25.0점

[4] 현재가/거래량 (가중치 20%)
    등락률: +3.85%
    거래량: 1,234,567주
    → 지표점수: 100점
    → 기여도: 100 × 0.20 = 20.0점

[5] 고급 추세 (가중치 15%)
    고가 근접: +15점 (85점)
    강한 모멘텀: +10점 (95점)
    → 지표점수: 95점
    → 기여도: 95 × 0.15 = 14.25점

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
최종 점수 = (20.0 + 20.0 + 25.0 + 20.0 + 14.25)
         = 99.25점 ≈ 99.3점

신뢰도 = 1.00 / 1.00 = 100% ✅

→ 신호: STRONG_BUY 🔥💰
→ 5개 지표 모두 긍정적, 신뢰도 최고
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 예시 2: 중립 신호 (3개 지표만 사용)

```
종목: 삼성전자

[1] 호가 분석 (가중치 20%)
    매수비율: 52%
    → 지표점수: 50점 (균형)
    → 기여도: 50 × 0.20 = 10.0점

[2] 체결강도 (가중치 20%)
    데이터 없음 ❌
    → 사용 불가

[3] 외국인/기관 (가중치 25%)
    외국인: -1,234주
    기관: +2,345주
    → 지표점수: 50점 (중립)
    → 기여도: 50 × 0.25 = 12.5점

[4] 현재가/거래량 (가중치 20%)
    등락률: +0.5%
    거래량: 500,000주
    → 지표점수: 50점 (보합)
    → 기여도: 50 × 0.20 = 10.0점

[5] 고급 추세 (가중치 15%)
    데이터 없음 ❌
    → 사용 불가

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
사용 지표: 3개 (hoga, investor, price)
가중치 합: 0.20 + 0.25 + 0.20 = 0.65

최종 점수 = (10.0 + 12.5 + 10.0) / 0.65
         = 32.5 / 0.65
         = 50.0점

신뢰도 = 0.65 / 1.00 = 65% ✅ (40% 이상이므로 통과)

→ 신호: HOLD ⏸️
→ 지표 수 부족하지만 신뢰도는 충분
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 예시 3: 신뢰도 부족으로 제외되는 경우

```
종목: 유진로봇

[1] 호가 분석 (가중치 20%)
    매수비율: 68%
    → 지표점수: 75점
    → 기여도: 75 × 0.20 = 15.0점

[2] 체결강도 (가중치 20%)
    데이터 없음 ❌

[3] 외국인/기관 (가중치 25%)
    데이터 없음 ❌

[4] 현재가/거래량 (가중치 20%)
    데이터 없음 ❌

[5] 고급 추세 (가중치 15%)
    데이터 없음 ❌

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
사용 지표: 1개 (hoga만)
가중치 합: 0.20

최종 점수 = 15.0 / 0.20 = 75점

신뢰도 = 0.20 / 1.00 = 20% ❌ (40% 미만)

→ 신호: 제외됨 ⛔
→ 이유: "지표 부족 (신뢰도 낮음)"
→ 최소 2개 지표 필요 (min_required_indicators=2)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 🎯 핵심 포인트

1. **가중치 시스템**: 외국인/기관(25%)이 가장 중요
2. **정규화**: 사용 가능한 지표만으로 100점 만점 재계산
3. **신뢰도 필터**: 40% 미만 신호는 자동 제외
4. **최소 지표**: 최소 2개 이상 지표 필요
5. **유연성**: 일부 지표 누락되어도 신뢰도만 충분하면 신호 생성

---

## 6. 신호 등급 체계

### 🎯 5단계 신호 등급

| 등급 | 점수 범위 | 의미 | 이모지 | 추천 행동 |
|------|-----------|------|--------|-----------|
| **STRONG_BUY** | 75-100점 | 매수 강력 추천 | 🔥💰 | 즉시 매수 검토 |
| **BUY** | 60-74점 | 매수 적기 | 📈✅ | 매수 고려 |
| **HOLD** | 40-59점 | 관망 | ⏸️ | 보유 또는 대기 |
| **SELL** | 25-39점 | 매도 고려 | ⚠️📉 | 매도 검토 |
| **STRONG_SELL** | 0-24점 | 매도 강력 추천 | 🚨❌ | 즉시 매도 검토 |

### 📌 신호 해석 가이드

#### STRONG_BUY (75점 이상)
```
✅ 여러 지표가 동시에 긍정적
✅ 매수세가 압도적으로 강함
✅ 세력(외국인/기관)이 적극 매수 중
→ 단기 급등 가능성 높음
```

#### BUY (60-74점)
```
✓ 대부분 지표가 긍정적
✓ 매수세가 우세함
✓ 상승 추세 형성 중
→ 중기 상승 기대
```

#### HOLD (40-59점)
```
➖ 지표가 혼조세
➖ 명확한 방향성 없음
➖ 관망 국면
→ 추가 신호 대기 권장
```

#### SELL (25-39점)
```
⚠️ 지표가 부정적
⚠️ 매도세 우세
⚠️ 하락 추세 가능성
→ 보유 시 매도 검토
```

#### STRONG_SELL (0-24점)
```
❌ 여러 지표가 동시에 부정적
❌ 매도세 압도적
❌ 세력 이탈 중
→ 손절 또는 매도 권장
```

---

## 7. 알림 시스템

### 📢 알림 발송 조건

시스템은 다음 조건을 **모두** 만족할 때 알림을 발송합니다:

1. **점수 조건**: 60점 이상 또는 SELL/STRONG_SELL 신호
2. **중복 방지**: 이전 신호와 다른 경우만
3. **조용한 모드** (디스코드): STRONG_BUY/STRONG_SELL만

### 📊 알림 발송 플로우

```
신호 발생
 ↓
점수 60점 이상? → NO → 종료
 ↓ YES
이전 신호와 동일? → YES → 스킵
 ↓ NO
신호 다운그레이드? → YES → 스킵
 ↓ NO
콘솔 알림 발송 ✅
 ↓
STRONG 신호? → YES → 디스코드 알림 ✅
 ↓ NO
완료
```

### 💬 알림 채널

#### 1. 콘솔 알림 (항상 출력)
```
==================================================
🔥💰 매매 신호 발생!
==================================================
종목: [defense] 한화오션 (042660)
신호: STRONG_BUY (점수: 78.5/100)
시각: 2025-01-27 10:35:22

📋 신호 이유:
  • ✅ 매수호가 우세 (72.3%)
  • ✅ 체결강도 매우 강함 (156.2%)
  • ✓ 외국인 순매수
  • ✅ 강한 상승세 (+3.85%)
  • ✓ 거래량 활발 (1,234,567주)

💹 현재가 정보:
  가격: 45,850원
  등락: +3.85%
  거래량: 1,234,567주
==================================================
```

#### 2. 디스코드 알림 (STRONG 신호만)
```
🔥💰 매매 신호 발생!
────────────────────────────────────────
종목: 🚀 [defense] 한화오션
코드: 042660
신호: STRONG_BUY (점수: 78.5/100)
시각: 2025-01-27 10:35:22

📋 신호 이유:
1. ✅ 매수호가 우세 (72.3%)
2. ✅ 체결강도 매우 강함 (156.2%)
3. ✓ 외국인 순매수
4. ✅ 강한 상승세 (+3.85%)
5. ✓ 거래량 활발 (1,234,567주)

💹 현재가 정보:
• 가격: 45,850원
• 등락: +3.85%
• 거래량: 1,234,567주

📊 호가 분석:
• 매수잔량: 123,456주
• 매도잔량: 45,678주
• 매수비율: 72.3%

⚡ 체결강도: 156.2%

🌐 세력 동향:
• 외국인: 순매수 12,345주
• 기관: 순매수 5,678주
────────────────────────────────────────
🔔 SignalMonitor_KR (조용한 모드 🔇)
```

---

## 8. 중복 방지 로직

### 🔇 조용한 모드 (적용됨)

시스템은 불필요한 중복 알림을 방지하기 위해 **3가지 규칙**을 적용합니다.

#### 규칙 1: 같은 신호 반복 차단

```
10:00 → 삼성전자 BUY (75점) → ✅ 알림 발송
10:05 → 삼성전자 BUY (76점) → ⏭️ 스킵 (신호 동일)
10:10 → 삼성전자 BUY (74점) → ⏭️ 스킵 (신호 동일)
```

#### 규칙 2: 신호 다운그레이드 차단

```
10:00 → 한화오션 STRONG_BUY (78점) → ✅ 알림 발송
10:05 → 한화오션 BUY (68점) → ⏭️ 스킵 (다운그레이드)
10:10 → 한화오션 BUY (65점) → ⏭️ 스킵 (신호 동일)
```

#### 규칙 3: 신호 변경 시 알림

```
10:00 → LG에너지솔루션 BUY (65점) → ✅ 알림 발송
10:30 → LG에너지솔루션 STRONG_BUY (78점) → ✅ 알림 발송 (업그레이드)
11:00 → LG에너지솔루션 SELL (35점) → ✅ 알림 발송 (신호 변경)
```

### 📊 알림 발송 판단표

| 이전 신호 | 현재 신호 | 알림 여부 | 이유 |
|-----------|-----------|-----------|------|
| NONE | STRONG_BUY | ✅ 발송 | 최초 신호 |
| STRONG_BUY | STRONG_BUY | ⏭️ 스킵 | 신호 동일 |
| STRONG_BUY | BUY | ⏭️ 스킵 | 다운그레이드 |
| BUY | STRONG_BUY | ✅ 발송 | 업그레이드 |
| BUY | HOLD | ✅ 발송 | 신호 변경 |
| STRONG_BUY | SELL | ✅ 발송 | 신호 변경 |
| BUY | BUY | ⏭️ 스킵 | 신호 동일 |

---

## 9. 설정 가이드

### ⚙️ MONITOR_CONFIG 설정 상세

```python
MONITOR_CONFIG = {
    # 기본 설정
    "check_interval_minutes": 5,     # 체크 주기 (분)
    "signal_threshold": 60,          # 알림 최소 점수
    "trading_hours_only": True,      # 장중에만 체크
    "save_history": True,            # 히스토리 저장
    
    # 파일 설정
    "history_file": "signal_history.json",
    "results_file": "signal_results.json",
    
    # 알림 설정
    "use_discord": True,             # 디스코드 알림 ON/OFF
    
    # 🔇 조용한 모드 설정
    "discord_only_strong_signals": True,   # STRONG만 디스코드
    "resend_alert_hours": 0,               # 재알림 없음
    "skip_downgrade_alerts": True,         # 다운그레이드 스킵
    
    # 🔥 신호 점수 정규화 설정 (최신 추가)
    "use_normalized_score": True,          # 가중치 정규화 ON
    "min_required_indicators": 2,          # 최소 필수 지표 수
    
    # 🔥 API Rate Limit 설정 (최신 추가)
    "api_max_calls_per_second": 5,         # 초당 최대 5회
    "api_throttle_enabled": True,          # API 스로틀링 ON
    
    # 🔥 히스토리 관리 설정 (최신 추가)
    "history_max_days": 7,                 # 7일 이상 자동 삭제
    "cache_max_size": 1000,                # 캐시 최대 항목 수
}

# 🔥 지표별 가중치 설정 (최신 추가)
INDICATOR_WEIGHTS = {
    "hoga": 0.20,        # 호가 분석 (20%)
    "execution": 0.20,   # 체결강도 (20%)
    "investor": 0.25,    # 외국인/기관 (25%) ⭐ 최고 비중
    "price": 0.20,       # 현재가/거래량 (20%)
    "trend": 0.15,       # 고급 추세 분석 (15%)
}
```

### 🎚️ 설정 변경 가이드

#### 체크 주기 변경
```python
"check_interval_minutes": 3,  # 3분마다 (더 자주)
"check_interval_minutes": 10, # 10분마다 (덜 자주)
```

#### 신호 민감도 조정
```python
"signal_threshold": 70,  # 70점 이상만 (민감도 낮춤)
"signal_threshold": 55,  # 55점 이상도 (민감도 높임)
```

#### 디스코드 알림 범위 조정
```python
# 조용한 모드 (현재)
"discord_only_strong_signals": True,  # STRONG_BUY/SELL만

# 일반 모드
"discord_only_strong_signals": False, # BUY 이상 모두

# 알림 끄기
"use_discord": False,
```

#### 재알림 설정
```python
"resend_alert_hours": 0,  # 재알림 없음 (현재)
"resend_alert_hours": 2,  # 2시간마다 재알림
"resend_alert_hours": 6,  # 6시간마다 재알림
```

#### 🔥 신호 정규화 설정 (최신)
```python
# 정규화 사용 (권장)
"use_normalized_score": True,     # 가중치 적용
"min_required_indicators": 2,     # 최소 2개 지표

# 단순 평균 사용 (비권장)
"use_normalized_score": False,    # 단순 평균
"min_required_indicators": 3,     # 최소 3개 지표
```

#### 🔥 API 스로틀링 설정 (최신)
```python
# 보수적 설정 (안정성 우선)
"api_max_calls_per_second": 3,    # 초당 3회
"api_throttle_enabled": True,

# 일반 설정 (현재)
"api_max_calls_per_second": 5,    # 초당 5회
"api_throttle_enabled": True,

# 적극적 설정 (속도 우선)
"api_max_calls_per_second": 10,   # 초당 10회
"api_throttle_enabled": True,

# 스로틀링 끄기 (비권장)
"api_throttle_enabled": False,
```

#### 🔥 히스토리 관리 설정 (최신)
```python
# 단기 보관
"history_max_days": 3,    # 3일만 보관
"cache_max_size": 500,    # 캐시 500개

# 중기 보관 (현재)
"history_max_days": 7,    # 7일 보관
"cache_max_size": 1000,   # 캐시 1000개

# 장기 보관
"history_max_days": 30,   # 30일 보관
"cache_max_size": 5000,   # 캐시 5000개
```

#### 🔥 지표 가중치 커스터마이징 (고급)
```python
# 기본 가중치 (현재)
INDICATOR_WEIGHTS = {
    "hoga": 0.20,
    "execution": 0.20,
    "investor": 0.25,      # 세력 동향 중시
    "price": 0.20,
    "trend": 0.15,
}

# 세력 초중시 전략
INDICATOR_WEIGHTS = {
    "hoga": 0.15,
    "execution": 0.15,
    "investor": 0.40,      # 세력 비중 대폭 증가
    "price": 0.15,
    "trend": 0.15,
}

# 기술적 분석 중시 전략
INDICATOR_WEIGHTS = {
    "hoga": 0.25,
    "execution": 0.25,
    "investor": 0.20,
    "price": 0.15,
    "trend": 0.15,         # 추세 분석 비중 동일
}

⚠️ 가중치 합계는 반드시 1.0이어야 함!
```

### 📋 추천 설정 프리셋

#### 1. 조용한 모드 (현재 적용) ✅
```python
"check_interval_minutes": 5,
"signal_threshold": 60,
"discord_only_strong_signals": True,
"resend_alert_hours": 0,
"skip_downgrade_alerts": True,
"use_normalized_score": True,
"min_required_indicators": 2,
"api_max_calls_per_second": 5,
```
**특징**: 최소한의 알림, STRONG 신호만, 정규화 ON

#### 2. 균형 모드
```python
"check_interval_minutes": 5,
"signal_threshold": 60,
"discord_only_strong_signals": False,
"resend_alert_hours": 2,
"skip_downgrade_alerts": True,
"use_normalized_score": True,
"min_required_indicators": 2,
"api_max_calls_per_second": 5,
```
**특징**: 모든 신호 알림, 2시간마다 재알림, 정규화 ON

#### 3. 적극적 모드
```python
"check_interval_minutes": 3,
"signal_threshold": 55,
"discord_only_strong_signals": False,
"resend_alert_hours": 1,
"skip_downgrade_alerts": False,
"use_normalized_score": True,
"min_required_indicators": 2,
"api_max_calls_per_second": 10,
```
**특징**: 빠른 체크, 낮은 임계값, 모든 변화 알림, 정규화 ON

#### 4. 보수적 모드 (안정성 최우선)
```python
"check_interval_minutes": 10,
"signal_threshold": 70,
"discord_only_strong_signals": True,
"resend_alert_hours": 0,
"skip_downgrade_alerts": True,
"use_normalized_score": True,
"min_required_indicators": 3,          # 3개 이상 지표 필요
"api_max_calls_per_second": 3,
```
**특징**: 느린 체크, 높은 임계값, STRONG만, 정규화 ON, 높은 신뢰도 요구

---

## 10. 실행 방법

### 🚀 시작하기

#### 1. 필수 파일 확인
```
프로젝트 폴더/
├── SignalMonitor_KR.py           # 메인 파일
├── Kiwoom_API_Helper_KR.py       # API 헬퍼
├── discord_alert.py              # 디스코드 알림
├── myStockInfo.yaml              # 키움 API 설정
├── web_dashboard.py              # 웹 대시보드 (선택)
├── templates/                    # 웹 대시보드 템플릿
│   └── index.html
└── logs/                         # 로그 폴더 (자동 생성)
```

#### 2. 실행 명령

**신호 모니터링 시작** (필수)
```bash
python SignalMonitor_KR.py
```

**웹 대시보드 시작** (선택, 별도 터미널)
```bash
python web_dashboard.py
```

#### 3. 시작 화면
```
============================================================
🚀 매매 신호 모니터링 시스템 시작 (최종 완성 버전)
============================================================
📊 모니터링 종목: 20개
⏱️ 체크 주기: 5분
📈 신호 임계값: 60점 이상
🔥 신호 점수 정규화: ON
💾 외국인/기관 캐싱: ON
🛡️ API 스로틀링: ON (초당 5회)
📈 고급 추세 분석: ON
🗑️ 히스토리 자동 정리: ON (7일)
💬 디스코드 알림: ON (STRONG 신호만)
============================================================
🔧 키움증권 API 초기화 중...
✅ 키움증권 API 초기화 완료
============================================================
⏰ 5분마다 자동 실행됩니다...
```

### 🛑 중단하기
```
Ctrl + C (터미널에서)
→ 안전하게 종료되며 디스코드에 종료 알림 발송
```

---

## 11. 로그 및 히스토리

### 📂 생성되는 파일

#### 1. 로그 파일
```
logs/
└── signal_monitor_20250127.log  # 날짜별 로그
└── signal_monitor_20250128.log
└── signal_monitor_20250129.log
```

**로그 내용**:
- API 호출 내역
- 분석 과정 상세
- 신호 발생 이력
- 알림 발송 내역
- 오류 메시지

**보관 기간**: 7일 (자동 삭제)

#### 2. 신호 히스토리
```
signal_history.json
```

**저장 내용**:
```json
[
  {
    "signal": "STRONG_BUY",
    "score": 78.5,
    "stock_code": "042660",
    "stock_name": "한화오션",
    "sector": "defense",
    "timestamp": "2025-01-27 10:35:22",
    "reasons": [
      "✅ 매수호가 우세 (72.3%)",
      "✅ 체결강도 매우 강함 (156.2%)",
      "..."
    ],
    "details": {
      "hoga": {...},
      "execution": {...},
      "stock_info": {...}
    }
  },
  ...
]
```

### 📊 히스토리 활용

#### 신호 정확도 분석
```python
# 나중에 분석 스크립트 작성 가능
import json

with open('signal_history.json', 'r') as f:
    history = json.load(f)

# STRONG_BUY 신호 후 실제 수익률 확인
strong_buy_signals = [h for h in history if h['signal'] == 'STRONG_BUY']
```

---

## 12. 웹 대시보드

### 🌐 개요

**SignalMonitor 웹 대시보드**는 실시간으로 신호를 모니터링할 수 있는 웹 인터페이스입니다.

### ✨ 주요 기능

#### 1️⃣ 실시간 모니터링
- ⏱️ **10초마다 자동 새로고침**
- 📊 **시스템 상태 실시간 표시**
- 🔥 **최신 신호 자동 업데이트**
- 🎯 **오늘의 신호 요약 대시보드**

#### 2️⃣ 신호 테이블
- 📋 **최근 20개 신호** 실시간 표시
- 🏷️ **섹터별 색상 구분** (로봇/원전/방산/2차전지/반도체)
- 🎨 **신호별 색상 구분** (STRONG_BUY ~ STRONG_SELL)
- ⏰ **상대 시간 표시** (방금 전, 5분 전, 1시간 전 등)

#### 3️⃣ 통계 차트
- 📊 **신호별 분포** (도넛 차트)
- 📈 **섹터별 신호 수** (막대 차트)
- 📅 **최근 7일 통계**
- 🎨 **Chart.js 기반 인터랙티브 차트**

#### 4️⃣ 검색 & 필터
- 🔍 **섹터별 필터링**
- 📊 **신호 유형별 필터링**
- 📅 **날짜 범위 검색**
- 📋 **검색 결과 테이블**

#### 5️⃣ 반응형 디자인
- 💻 **PC 최적화** (큰 화면)
- 📱 **모바일 최적화** (작은 화면)
- 🎨 **다크 테마** (GitHub 스타일)
- 🌈 **색상 코딩** (한눈에 파악)

### 🚀 설치 및 실행

#### 1. 파일 구조 확인
```
프로젝트 폴더/
├── web_dashboard.py              # Flask 서버
├── signal_history.json           # 신호 데이터 (자동 생성)
└── templates/                    # HTML 템플릿
    └── index.html                # 대시보드 UI
```

#### 2. 실행 방법

**① SignalMonitor 먼저 실행** (신호 수집)
```bash
python SignalMonitor_KR.py
```

**② 웹 대시보드 실행** (별도 터미널)
```bash
python web_dashboard.py
```

**③ 웹 브라우저 접속**
- PC: http://localhost:5000
- 모바일: http://[PC의IP주소]:5000

#### 3. 시작 화면
```
============================================================
🚀 SignalMonitor 웹 대시보드 시작
============================================================
📊 접속 주소: http://localhost:5000
📱 모바일: http://[서버IP]:5000
============================================================
```

### 📊 대시보드 화면 구성

```
┌─────────────────────────────────────────────────────────┐
│  📊 SignalMonitor 대시보드                               │
│  ● 정상 작동 중   업데이트: 2025-01-27 10:35:22        │
├─────────────────────────────────────────────────────────┤
│  [오늘 신호: 15]  [강력매수: 3]  [매수: 8]  [매도: 2]   │
├─────────────────────────────────────────────────────────┤
│  최근 신호 (실시간)                     [🔄 새로고침]   │
│  ┌─────────────────────────────────────────────────┐  │
│  │ 시간  │섹터│종목명    │코드    │신호│점수│신뢰도│  │
│  ├─────────────────────────────────────────────────┤  │
│  │10:35 │🚀  │한화오션  │042660  │🔥 │78.5│85% │  │
│  │10:30 │⚡  │두산에너빌│034020  │📈 │65.2│70% │  │
│  │10:25 │🤖  │유진로봇  │056080  │📈 │62.8│68% │  │
│  │...                                              │  │
│  └─────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────┤
│  [신호별 분포 차트]        [섹터별 신호 차트]           │
│   🔥 강력매수: 20%          🤖 로봇: 8건                │
│   📈 매수: 45%              ⚡원전: 12건               │
│   ⏸️ 보유: 25%              🚀 방산: 15건               │
│   ⚠️ 매도: 10%              🔋 2차전지: 10건            │
├─────────────────────────────────────────────────────────┤
│  검색 & 필터                                            │
│  [섹터: 전체▼] [신호: 전체▼] [시작일: ___] [종료일: ___]│
│  [🔍 검색] [↺ 초기화]                                   │
└─────────────────────────────────────────────────────────┘
```

### 🎨 화면 요소 설명

#### 상단 상태바
- **🟢 정상 작동 중**: SignalMonitor가 정상 작동 중
- **🟡 업데이트 없음**: 10분 이상 신호 없음
- **🔴 오류**: 시스템 오류 발생
- **마지막 업데이트**: signal_history.json 수정 시간

#### 오늘의 요약 카드
- **오늘 신호**: 오늘 발생한 총 신호 수
- **강력 매수**: STRONG_BUY 신호 수
- **매수 신호**: BUY 신호 수
- **매도 신호**: SELL + STRONG_SELL 신호 수

#### 신호 테이블
- **시간**: 상대 시간 표시 (방금 전, 5분 전 등)
- **섹터**: 이모지 + 한글 이름
- **종목명**: 종목 이름
- **종목코드**: 6자리 코드
- **신호**: 이모지 + 신호 등급 (색상 구분)
- **점수**: 0-100점
- **신뢰도**: 백분율 (%)

#### 차트
- **신호별 분포**: 도넛 차트 (비율 시각화)
- **섹터별 신호**: 막대 차트 (개수 비교)
- **기간**: 최근 7일 데이터

#### 검색 & 필터
- **섹터 필터**: 특정 섹터만 보기
- **신호 필터**: 특정 신호 등급만 보기
- **날짜 범위**: 특정 기간 검색
- **검색 실행**: 조건에 맞는 신호 표시

### 🔧 커스터마이징

#### 자동 새로고침 주기 변경
**파일**: `templates/index.html`

```javascript
// 10초마다 (기본값)
setInterval(() => {
    loadSystemStatus();
    loadRecentSignals();
    loadStatistics();
}, 10000);

// 30초마다로 변경
setInterval(() => {
    loadSystemStatus();
    loadRecentSignals();
    loadStatistics();
}, 30000);
```

#### 포트 번호 변경
**파일**: `web_dashboard.py`

```python
# 기본 포트 5000
app.run(host='0.0.0.0', port=5000, debug=False)

# 포트 8080으로 변경
app.run(host='0.0.0.0', port=8080, debug=False)
```

#### 신호 테이블 행 수 변경
**파일**: `templates/index.html`

```javascript
// 20개 표시 (기본값)
const response = await fetch('/api/signals/recent?limit=20');

// 50개로 변경
const response = await fetch('/api/signals/recent?limit=50');
```

### 📱 모바일 접속 방법

#### 1. PC의 IP 주소 확인
```bash
# Windows
ipconfig

# macOS/Linux
ifconfig
```

#### 2. 방화벽 설정
- Windows: 5000번 포트 허용
- macOS: 시스템 설정 > 보안 > 방화벽

#### 3. 모바일에서 접속
```
http://192.168.0.10:5000
(192.168.0.10을 실제 PC IP로 변경)
```

### ⚠️ 주의사항

1. **SignalMonitor가 먼저 실행되어야 합니다**
   - 웹 대시보드는 signal_history.json을 읽기만 함
   - SignalMonitor가 없으면 데이터가 없음

2. **실시간 신호는 SignalMonitor에서 발생**
   - 웹 대시보드는 이미 발생한 신호를 표시
   - 신호 발생 → JSON 저장 → 대시보드 표시

3. **외부 접속 시 보안 주의**
   - 기본적으로 모든 IP에서 접속 가능 (0.0.0.0)
   - 필요시 특정 IP만 허용하도록 설정

4. **대용량 히스토리 주의**
   - signal_history.json이 너무 크면 느려질 수 있음
   - 정기적으로 백업 후 초기화 권장

### 🎯 활용 시나리오

#### 시나리오 1: 실시간 모니터링
```
1. PC에서 SignalMonitor 실행
2. 웹 대시보드 실행
3. 모바일로 접속하여 외출 중에도 확인
4. 강력 매수 신호 발생 시 즉시 대응
```

#### 시나리오 2: 히스토리 분석
```
1. 검색 & 필터 기능 활용
2. 특정 섹터의 STRONG_BUY 신호만 검색
3. 날짜 범위로 최근 1주일 데이터 분석
4. 신호 정확도 검증
```

#### 시나리오 3: 통계 확인
```
1. 대시보드에서 차트 확인
2. 어떤 섹터에서 신호가 많은지 파악
3. 어떤 신호 유형이 자주 발생하는지 분석
4. 투자 전략 수립에 활용
```

---

## 13. FAQ

### ❓ 자주 묻는 질문

#### Q1. 신호가 발생했는데 알림이 안 와요
**A**: 다음을 확인하세요:
1. 조용한 모드에서는 **STRONG_BUY/STRONG_SELL만** 디스코드 알림
2. 이전 신호와 동일하면 중복 방지로 **스킵**
3. 신호 다운그레이드도 **스킵**
4. **신뢰도 40% 미만**이면 신호 자동 제외
5. 콘솔 로그는 항상 출력되니 확인해보세요

#### Q2. 특정 종목만 모니터링하고 싶어요
**A**: `TARGET_STOCKS` 딕셔너리에서 원하는 종목만 남기세요:
```python
TARGET_STOCKS = {
    "042660": {"name": "한화오션", "sector": "defense"},
    "005930": {"name": "삼성전자", "sector": "semiconductor"},
}
```

#### Q3. 더 자주 체크하고 싶어요
**A**: `check_interval_minutes`를 변경하세요:
```python
"check_interval_minutes": 3,  # 3분마다
```

#### Q4. 모든 신호를 디스코드로 받고 싶어요
**A**: 설정을 변경하세요:
```python
"discord_only_strong_signals": False,  # 모든 신호
```

#### Q5. 토큰 만료 오류가 나요
**A**: 키움 API 토큰은 자동 갱신됩니다. 하지만 오류가 계속되면:
1. `myStockInfo.yaml` 파일 확인
2. API Key/Secret 정확한지 확인
3. 프로그램 재시작

#### Q6. 장 마감 후에도 실행되나요?
**A**: 아니요. `trading_hours_only: True` 설정으로 **장중(09:00-15:30)만** 동작합니다.

#### Q7. 신호 점수는 어떻게 해석하나요?
**A**: 
- **75점 이상**: 즉시 매수 검토
- **60-74점**: 매수 고려
- **40-59점**: 관망
- **25-39점**: 매도 고려
- **24점 이하**: 손절 검토

#### Q8. 왜 조용한 모드를 기본으로 했나요?
**A**: 
- 초보자에게는 STRONG 신호가 더 신뢰도 높음
- 너무 많은 알림은 혼란 유발
- BUY 신호는 콘솔 로그에서 확인 가능

#### Q9. 실제 매매에 바로 사용해도 되나요?
**A**: 
- ❌ **권장하지 않습니다**
- ✅ **1-2주 신호를 관찰**하고 정확도 검증 후 사용
- ✅ 히스토리 분석으로 **백테스팅** 권장

#### Q10. 히스토리는 언제까지 저장되나요?
**A**: 
- `signal_history.json`은 **7일 자동 삭제** (history_max_days 설정)
- 로그 파일도 **7일 자동 삭제**

#### Q11. 웹 대시보드가 데이터를 안 보여줘요 ⭐
**A**: 다음을 확인하세요:
1. **SignalMonitor_KR.py가 실행 중인지** 확인
2. **signal_history.json 파일이 존재하는지** 확인
3. 브라우저 **개발자 도구(F12)**에서 에러 확인
4. 웹 대시보드 **재시작** 시도

#### Q12. 웹 대시보드 접속이 안 돼요 ⭐
**A**: 다음을 확인하세요:
1. **web_dashboard.py가 실행 중인지** 확인
2. **포트 5000이 사용 중인지** 확인 (다른 프로그램)
3. **방화벽 설정** 확인 (5000번 포트 허용)
4. 브라우저 주소창에 정확한 URL 입력

#### Q13. 모바일에서 대시보드 접속이 안 돼요 ⭐
**A**: 다음을 확인하세요:
1. **PC와 모바일이 같은 Wi-Fi**에 연결되어 있는지
2. **PC의 IP 주소**가 정확한지 확인
3. **방화벽에서 5000번 포트 허용** 확인
4. `http://192.168.0.10:5000` 형식으로 입력 (HTTPS 아님)

#### Q14. 웹 대시보드에서 차트가 안 보여요 ⭐
**A**: 다음을 확인하세요:
1. **인터넷 연결** 확인 (Chart.js CDN 사용)
2. 브라우저 **캐시 삭제** 후 재접속
3. **다른 브라우저**에서 시도 (Chrome, Edge, Safari 등)
4. 브라우저 **개발자 도구(F12)**에서 에러 확인

#### Q15. 웹 대시보드의 자동 새로고침 주기를 바꾸고 싶어요 ⭐
**A**: `templates/index.html` 파일을 수정하세요:
```javascript
// 10초마다 (기본값)
setInterval(() => {...}, 10000);

// 30초마다로 변경
setInterval(() => {...}, 30000);
```

#### Q16. "지표 부족 (신뢰도 낮음)" 메시지가 자주 나와요 🆕
**A**: 다음을 확인하세요:
1. **신뢰도 40% 미만**일 때 발생하는 메시지입니다
2. **최소 2개 지표 필요** (min_required_indicators=2)
3. API 응답이 불완전할 때 발생 가능
4. 설정에서 `min_required_indicators: 1`로 낮출 수 있지만 **비권장**

#### Q17. 가중치를 내가 원하는 대로 바꿀 수 있나요? 🆕
**A**: 네, 가능합니다:
```python
INDICATOR_WEIGHTS = {
    "hoga": 0.20,
    "execution": 0.20,
    "investor": 0.30,      # 세력 비중 증가
    "price": 0.15,
    "trend": 0.15,
}
```
⚠️ **주의**: 가중치 합계는 반드시 **1.0**이어야 합니다!

#### Q18. 정규화 점수와 단순 평균, 뭐가 더 좋나요? 🆕
**A**: 
- **정규화 점수 (권장)** ✅
  - 지표별 중요도 반영
  - 외국인/기관 데이터 중시 (25%)
  - 일부 지표 누락되어도 정확한 점수 계산
  
- **단순 평균 (비권장)** ❌
  - 모든 지표 동일 가중치
  - 중요도 무시
  - 신뢰도 계산 부정확

#### Q19. 신뢰도란 정확히 무엇인가요? 🆕
**A**: 
```
신뢰도 = (사용된 지표의 가중치 합) / (전체 가중치 합)

예시:
- 5개 모두 사용: 100% (최고 신뢰도)
- 4개 사용: 80-85% (높은 신뢰도)
- 3개 사용: 60-65% (보통 신뢰도)
- 2개 사용: 40-45% (낮은 신뢰도)
- 1개 사용: 15-25% (매우 낮음 → 제외됨)
```

신뢰도 **40% 미만**은 자동으로 **신호 제외**됩니다.

#### Q20. API 스로틀링이 뭔가요? 🆕
**A**: 
- 키움 API는 **초당 호출 횟수 제한**이 있습니다
- 너무 빠르게 호출하면 **오류 발생** 가능
- 스로틀링은 자동으로 **대기 시간 추가**하여 안정성 확보
- 기본값: 초당 최대 5회 호출
- 설정에서 조정 가능하지만 **너무 높이면 위험**

---

## 📚 추가 자료

### 🔗 관련 문서
- 키움증권 API 문서
- Kiwoom_API_Helper_KR.py 가이드
- 디스코드 웹훅 설정 가이드
- Flask 웹 프레임워크 문서 ⭐ NEW!
- Chart.js 라이브러리 문서 ⭐ NEW!

### 💡 개선 아이디어
- ~~신호 정확도 자동 분석 대시보드~~ ✅ **완료!** (웹 대시보드에 통계 기능 포함)
- 텔레그램 알림 추가
- ~~웹 대시보드 개발~~ ✅ **완료!** ⭐
- 실시간 차트 연동
- 백테스팅 자동화 시스템
- 모바일 앱 개발 (React Native)
- 신호 알림 푸시 알림 기능
- AI 기반 신호 정확도 예측 모델
- 다중 브로커 지원 (KIS, 이베스트 등)

### 🆕 최근 업데이트 (2025-01-27)
- ✅ **웹 대시보드 추가**: Flask 기반 실시간 모니터링 UI
- ✅ **반응형 디자인**: PC/모바일 모두 지원
- ✅ **실시간 차트**: Chart.js 기반 인터랙티브 차트
- ✅ **검색 & 필터**: 섹터/신호/날짜별 검색 기능
- ✅ **자동 새로고침**: 10초마다 자동 업데이트
- ✅ **신호 점수 정규화**: 가중치 기반 점수 계산 시스템 (정확도 향상)
- ✅ **신뢰도 계산**: 사용 지표 수에 따른 신뢰도 평가
- ✅ **고급 추세 분석**: 고가/저가 위치, 모멘텀, 상한가/하한가 분석
- ✅ **API 스로틀링**: 초당 호출 제한으로 안정성 99%
- ✅ **외국인/기관 캐싱**: 중복 API 호출 방지로 속도 3배 향상
- ✅ **자동 히스토리 관리**: 7일 이상 데이터 자동 삭제

---

## 📮 문의 및 피드백

시스템 개선 제안이나 버그 리포트는 프로젝트 관리자에게 문의하세요.

---

**마지막 업데이트**: 2025-01-27
**버전**: 1.2 (신호 점수 정규화 시스템 업데이트)
**작성자**: AI Assistant